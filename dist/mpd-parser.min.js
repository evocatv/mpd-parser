/*! @name mpd-parser @version 0.21.1 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@xmldom/xmldom")):"function"==typeof define&&define.amd?define(["exports","@xmldom/xmldom"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mpdParser={},e.window)}(this,(function(e,t){"use strict";var n=function(e){return!!e&&"object"==typeof e},r=function e(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.reduce((function(t,r){return"object"!=typeof r||Object.keys(r).forEach((function(i){Array.isArray(t[i])&&Array.isArray(r[i])?t[i]=t[i].concat(r[i]):n(t[i])&&n(r[i])?t[i]=e(t[i],r[i]):t[i]=r[i]})),t}),{})},i=function(e){return Object.keys(e).map((function(t){return e[t]}))},a=function(e){return e.reduce((function(e,t){return e.concat(t)}),[])},o=function(e){if(!e.length)return[];for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},u=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},s="INVALID_NUMBER_OF_PERIOD",c="DASH_EMPTY_MANIFEST",l="DASH_INVALID_XML",d="NO_BASE_URL",m="SEGMENT_TIME_UNSPECIFIED",f="UNSUPPORTED_UTC_TIMING_SCHEME";var p=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){var n,r,i,a,o;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=o.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var u=o.parseURL(e);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var s=r.exec(u.path);u.netLoc=s[1],u.path=s[2]}u.netLoc&&!u.path&&(u.path="/");var c={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var l=u.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;c.path=o.normalizePath(d)}else c.path=u.path,a.params||(c.params=u.params,a.query||(c.query=u.query));return null===c.path&&(c.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(c)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o})),v="http://example.com",g=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window.location&&window.location.href||"");var n="function"==typeof window.URL,r=/^\/\//.test(e),i=!window.location&&!/\/\//i.test(e);if(n?e=new window.URL(e,window.location||v):/\/\//i.test(e)||(e=p.buildAbsoluteURL(window.location&&window.location.href||"",e)),n){var a=new URL(t,e);return i?a.href.slice(v.length):r?a.href.slice(a.protocol.length):a.href}return p.buildAbsoluteURL(e,t)},h=function(e){var t=e.baseUrl,n=void 0===t?"":t,r=e.source,i=void 0===r?"":r,a=e.range,o=void 0===a?"":a,u=e.indexRange,s=void 0===u?"":u,c={uri:i,resolvedUri:g(n||"",i)};if(o||s){var l,d=(o||s).split("-"),m=window.BigInt?window.BigInt(d[0]):parseInt(d[0],10),f=window.BigInt?window.BigInt(d[1]):parseInt(d[1],10);m<Number.MAX_SAFE_INTEGER&&"bigint"==typeof m&&(m=Number(m)),f<Number.MAX_SAFE_INTEGER&&"bigint"==typeof f&&(f=Number(f)),"bigint"==typeof(l="bigint"==typeof f||"bigint"==typeof m?window.BigInt(f)-window.BigInt(m)+window.BigInt(1):f-m+1)&&l<Number.MAX_SAFE_INTEGER&&(l=Number(l)),c.byterange={length:l,offset:m}}return c},b=function(e){return e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e},y={static:function(e){var t=e.duration,n=e.timescale,r=void 0===n?1:n,i=e.sourceDuration,a=e.periodDuration,o=b(e.endNumber),u=t/r;return"number"==typeof o?{start:0,end:o}:"number"==typeof a?{start:0,end:a/u}:{start:0,end:i/u}},dynamic:function(e){var t=e.NOW,n=e.clientOffset,r=e.availabilityStartTime,i=e.timescale,a=void 0===i?1:i,o=e.duration,u=e.periodStart,s=void 0===u?0:u,c=e.minimumUpdatePeriod,l=void 0===c?0:c,d=e.timeShiftBufferDepth,m=void 0===d?1/0:d,f=b(e.endNumber),p=(t+n)/1e3,v=r+s,g=p+l-v,h=Math.ceil(g*a/o),y=Math.floor((p-v-m)*a/o),w=Math.floor((p-v)*a/o);return{start:Math.max(0,y),end:"number"==typeof f?f:Math.min(h,w)}}},w=function(e){var t=e.type,n=e.duration,r=e.timescale,i=void 0===r?1:r,a=e.periodDuration,o=e.sourceDuration,u=y[t](e),s=function(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n}(u.start,u.end).map(function(e){return function(t){var n=e.duration,r=e.timescale,i=void 0===r?1:r,a=e.periodStart,o=e.startNumber;return{number:(void 0===o?1:o)+t,duration:n/i,timeline:a,time:t*n}}}(e));if("static"===t){var c=s.length-1,l="number"==typeof a?a:o;s[c].duration=l-n/i*c}return s},U=function(e){var t=e.baseUrl,n=e.initialization,r=void 0===n?{}:n,i=e.sourceDuration,a=e.indexRange,o=void 0===a?"":a,u=e.periodStart,s=e.presentationTime,c=e.number,l=void 0===c?0:c,m=e.duration;if(!t)throw new Error(d);var f=h({baseUrl:t,source:r.sourceURL,range:r.range}),p=h({baseUrl:t,source:t,indexRange:o});if(p.map=f,m){var v=w(e);v.length&&(p.duration=v[0].duration,p.timeline=v[0].timeline)}else i&&(p.duration=i,p.timeline=u);return p.presentationTime=s||u,p.number=l,[p]},S=function(e,t,n){var r,i=e.sidx.map?e.sidx.map:null,a=e.sidx.duration,o=e.timeline||0,u=e.sidx.byterange,s=u.offset+u.length,c=t.timescale,l=t.references.filter((function(e){return 1!==e.referenceType})),d=[],m=e.endList?"static":"dynamic",f=e.sidx.timeline,p=f,v=e.mediaSequence||0;r="bigint"==typeof t.firstOffset?window.BigInt(s)+t.firstOffset:s+t.firstOffset;for(var g=0;g<l.length;g++){var h=t.references[g],b=h.referencedSize,y=h.subsegmentDuration,w=void 0;w="bigint"==typeof r?r+window.BigInt(b)-window.BigInt(1):r+b-1;var S=U({baseUrl:n,timescale:c,timeline:o,periodStart:f,presentationTime:p,number:v,duration:y,sourceDuration:a,indexRange:r+"-"+w,type:m})[0];i&&(S.map=i),d.push(S),r+="bigint"==typeof r?window.BigInt(b):b,p+=y/c,v++}return e.segments=d,e},I=["AUDIO","SUBTITLES"],E=function(e){return(t=e,n=function(e){return e.timeline},i(t.reduce((function(e,t){return t.forEach((function(t){e[n(t)]=t})),e}),{}))).sort((function(e,t){return e.timeline>t.timeline?1:-1}));var t,n},T=function(e){var t,n,r=[];return t=e,n=function(e,t,n,i){r=r.concat(e.playlists||[])},I.forEach((function(e){for(var r in t.mediaGroups[e])for(var i in t.mediaGroups[e][r]){var a=t.mediaGroups[e][r][i];n(a,e,r,i)}})),r},R=function(e){var t=e.playlist,n=e.mediaSequence;t.mediaSequence=n,t.segments.forEach((function(e,n){e.number=t.mediaSequence+n}))},L=function(e){var t=e.oldManifest,n=e.newManifest,r=t.playlists.concat(T(t)),i=n.playlists.concat(T(n));return n.timelineStarts=E([t.timelineStarts,n.timelineStarts]),function(e){var t=e.oldPlaylists,n=e.newPlaylists,r=e.timelineStarts;n.forEach((function(e){e.discontinuitySequence=u(r,(function(t){return t.timeline===e.timeline}));var n=function(e,t){for(var n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null}(t,e.attributes.NAME);if(n&&!e.sidx){var i=e.segments[0],a=u(n.segments,(function(e){return Math.abs(e.presentationTime-i.presentationTime)<.016666666666666666}));if(-1===a)return R({playlist:e,mediaSequence:n.mediaSequence+n.segments.length}),e.segments[0].discontinuity=!0,e.discontinuityStarts.unshift(0),void((!n.segments.length&&e.timeline>n.timeline||n.segments.length&&e.timeline>n.segments[n.segments.length-1].timeline)&&e.discontinuitySequence--);n.segments[a].discontinuity&&!i.discontinuity&&(i.discontinuity=!0,e.discontinuityStarts.unshift(0),e.discontinuitySequence--),R({playlist:e,mediaSequence:n.segments[a].number})}}))}({oldPlaylists:r,newPlaylists:i,timelineStarts:n.timelineStarts}),n},N=function(e){return e&&e.uri+"-"+(t=e.byterange,n="bigint"==typeof t.offset||"bigint"==typeof t.length?window.BigInt(t.offset)+window.BigInt(t.length)-window.BigInt(1):t.offset+t.length-1,t.offset+"-"+n);var t,n},x=function(e){return i(e.reduce((function(e,t){var n,r=t.attributes.id+(t.attributes.lang||"");e[r]?t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),(n=e[r].segments).push.apply(n,t.segments)):(e[r]=t,e[r].attributes.timelineStarts=[]);return e[r].attributes.timelineStarts.push({start:t.attributes.periodStart}),e}),{})).map((function(e){return e}))},D=function(e,t){var n=N(e.sidx),r=n&&t[n]&&t[n].sidx;return r&&S(e,r,e.sidx.resolvedUri),e},P=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var n in e)e[n]=D(e[n],t);return e},M=function(e){var t=e.attributes,n=e.segments,r=e.sidx,i={timelineStarts:t.timelineStarts,initUri:n[0].map.uri,initResolvedUri:n[0].map.resolvedUri,segments:n};return r&&(i.sidx=r),i},A=function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType},O=function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType},B=function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType},q=function(e){return e?Object.keys(e).reduce((function(t,n){var r=e[n];return t.concat(r.playlists)}),[]):[]},z=function(e){var t=e.dashPlaylists,n=e.locations,r=e.sidxMapping,i=void 0===r?{}:r,a=e.previousManifest;if(!t.length)return{};var o=t[0].attributes;o.sourceDuration;var u=o.type,s=o.suggestedPresentationDelay,c=o.minimumUpdatePeriod,l=x(t.filter(A)).map(M),d=x(t.filter(O)),m=x(t.filter(B));t.map((function(e){return e.attributes.captionServices})).filter(Boolean);var f={playlists:P(l,i)};c>=0&&(f.minimumUpdatePeriod=1e3*c),n&&(f.locations=n),"dynamic"===u&&(f.suggestedPresentationDelay=s);var p,v=0===f.playlists.length,g=d.length?function(e,t,n){var r;void 0===t&&(t={}),void 0===n&&(n=!1);var i=e.reduce((function(e,i){var a=i.attributes.role&&i.attributes.role.value||"",o=i.attributes.lang||"",u=i.attributes.label||"main";if(o&&!i.attributes.label){var s=a?" ("+a+")":"";u=""+i.attributes.lang+s}e[u]||(e[u]={language:o,autoselect:!0,default:"main"===a,playlists:[]});var c=D(function(e,t){var n=e.attributes,r=e.segments,i=e.sidx,a=e.mediaSequence,o={timelineStarts:n.timelineStarts,mediaSequence:a,segments:r};return i&&(o.sidx=i),t&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o}(i,n),t);return e[u].playlists.push(c),void 0===r&&"main"===a&&((r=i).default=!0),e}),{});return r||(i[Object.keys(i)[0]].default=!0),i}(d,i,v):null,h=m.length?function(e,t){return void 0===t&&(t={}),e.reduce((function(e,n){var r=n.attributes.lang||"text";return e[r]||(e[r]={language:r,default:!1,autoselect:!1,playlists:[]}),e[r].playlists.push(D(function(e){var t,n=e.attributes,r=e.segments,i=e.mediaSequence;void 0===r&&(r=[{uri:n.baseUrl,resolvedUri:n.baseUrl||"",duration:n.sourceDuration,number:0}],n.duration=n.sourceDuration);var a=((t={NAME:n.id,BANDWIDTH:n.bandwidth})["PROGRAM-ID"]=1,t);return n.codecs&&(a.CODECS=n.codecs),{attributes:a,resolvedUri:n.baseUrl||"",mediaSequence:i,segments:r}}(n),t)),e}),{})}(m,i):null,b=l.concat(q(g),q(h)),y=b.map((function(e){return e.timelineStarts}));if(f.timelineStarts=E(y),p=b,f.timelineStarts,p.forEach((function(e){e.mediaSequence=0,e.segments&&e.segments.forEach((function(e,t){e.number=t}))})),g){var w=[];w.push.apply(w,Object.values(g)),w.forEach((function(e){f.playlists.push({initResolvedUri:e.playlists[0].segments[0].map.resolvedUri,initUri:e.playlists[0].segments[0].map.uri,segments:e.playlists})}))}return a?L({oldManifest:a,newManifest:f}):f},_=function(e,t,n){var r=e.NOW,i=e.clientOffset,a=e.availabilityStartTime,o=e.timescale,u=void 0===o?1:o,s=e.periodStart,c=void 0===s?0:s,l=e.minimumUpdatePeriod,d=(r+i)/1e3+(void 0===l?0:l)-(a+c);return Math.ceil((d*u-t)/n)},F=function(e,t){for(var n=e.type,r=e.minimumUpdatePeriod,i=void 0===r?0:r,a=e.media,o=void 0===a?"":a,u=e.sourceDuration,s=e.timescale,c=void 0===s?1:s,l=e.startNumber,d=void 0===l?1:l,m=e.periodStart,f=[],p=-1,v=0;v<t.length;v++){var g=t[v],h=g.d,b=g.r||0,y=g.t||0;p<0&&(p=y),y&&y>p&&(p=y);var w=void 0;if(b<0){var U=v+1;w=U===t.length?"dynamic"===n&&i>0&&o.indexOf("$Number$")>0?_(e,p,h):(u*c-p)/h:(t[U].t-p)/h}else w=b+1;for(var S=d+f.length+w,I=d+f.length;I<S;)f.push({number:I,duration:h/c,time:p,timeline:m}),p+=h,I++}return f},C=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,j=function(e,t){return e.replace(C,function(e){return function(t,n,r,i){if("$$"===t)return"$";if(void 0===e[n])return t;var a=""+e[n];return"RepresentationID"===n?a:(i=r?parseInt(i,10):1,a.length>=i?a:""+new Array(i-a.length+1).join("0")+a)}}(t))},k=function(e,t){var n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},r=e.initialization,i=void 0===r?{sourceURL:"",range:""}:r,a=h({baseUrl:e.baseUrl,source:j(i.sourceURL,n),range:i.range}),o=function(e,t){return e.duration||t?e.duration?w(e):F(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}]}(e,t);return o.map((function(t){n.Number=t.number,n.Time=t.time;var r=j(e.media||"",n);e.timescale,e.presentationTimeOffset;return e.periodStart,t.time,{uri:r,resolvedUri:g(e.baseUrl||"",r),map:a,number:t.number,attributes:e}}))},$=function(e,t){var n=e.duration,r=e.segmentUrls,i=void 0===r?[]:r,a=e.periodStart;if(!n&&!t||n&&t)throw new Error(m);var o,u=i.map((function(t){return function(e,t){var n=e.baseUrl,r=e.initialization,i=void 0===r?{}:r,a=h({baseUrl:n,source:i.sourceURL,range:i.range}),o=h({baseUrl:n,source:t.media,range:t.mediaRange});return o.map=a,o}(e,t)}));return n&&(o=w(e)),t&&(o=F(e,t)),o.map((function(t,n){if(u[n]){var r=u[n],i=e.timescale||1,o=e.presentationTimeOffset||0;return r.timeline=t.timeline,r.duration=t.duration,r.number=t.number,r.presentationTime=a+(t.time-o)/i,r}})).filter((function(e){return e}))},G=function(e){var t,n,i=e.attributes,a=e.segmentInfo;a.template?(n=k,t=r(i,a.template)):a.base?(n=U,t=r(i,a.base)):a.list&&(n=$,t=r(i,a.list));var o={attributes:i};if(!n)return o;var u=n(t,a.segmentTimeline);if(t.duration){var s=t,c=s.duration,l=s.timescale,d=void 0===l?1:l;t.duration=c/d}else u.length?t.duration=u.reduce((function(e,t){return Math.max(e,Math.ceil(t.duration))}),0):t.duration=0;return o.attributes=t,o.segments=u,a.base&&t.indexRange&&(o.sidx=u[0],o.segments=[]),o},H=function(e){return e.map(G)},V=function(e,t){return o(e.childNodes).filter((function(e){return e.tagName===t}))},W=function(e){return e.textContent.trim()},X=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var n=t.slice(1),r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5];return 31536e3*parseFloat(r||0)+2592e3*parseFloat(i||0)+86400*parseFloat(a||0)+3600*parseFloat(o||0)+60*parseFloat(u||0)+parseFloat(s||0)},Y={mediaPresentationDuration:function(e){return X(e)},availabilityStartTime:function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:function(e){return X(e)},suggestedPresentationDelay:function(e){return X(e)},type:function(e){return e},timeShiftBufferDepth:function(e){return X(e)},start:function(e){return X(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},presentationTimeOffset:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?X(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},Z=function(e){return e&&e.attributes?o(e.attributes).reduce((function(e,t){var n=Y[t.name]||Y.DEFAULT;return e[t.name]=n(t.value),e}),{}):{}};function K(e){for(var t,n=(t=e,window.atob?window.atob(t):Buffer.from(t,"base64").toString("binary")),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}var J={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Q=function(e,t){return t.length?a(e.map((function(e){return t.map((function(t){return g(e,W(t))}))}))):e},ee=function(e){var t=V(e,"SegmentTemplate")[0],n=V(e,"SegmentList")[0],i=n&&V(n,"SegmentURL").map((function(e){return r({tag:"SegmentURL"},Z(e))})),a=V(e,"SegmentBase")[0],o=n||t,u=o&&V(o,"SegmentTimeline")[0],s=n||a||t,c=s&&V(s,"Initialization")[0],l=t&&Z(t);l&&c?l.initialization=c&&Z(c):l&&l.initialization&&(l.initialization={sourceURL:l.initialization});var d={template:l,segmentTimeline:u&&V(u,"S").map((function(e){return Z(e)})),list:n&&r(Z(n),{segmentUrls:i,initialization:Z(c)}),base:a&&r(Z(a),{initialization:Z(c)})};return Object.keys(d).forEach((function(e){d[e]||delete d[e]})),d},te=function(e,t,n){return function(i){var o,u=Z(i),s=Q(t,V(i,"BaseURL")),c=V(i,"Role")[0],l={role:Z(c)},d=r(e,u,l),m=V(i,"Accessibility")[0],f="urn:scte:dash:cc:cea-608:2015"===(o=Z(m)).schemeIdUri?("string"!=typeof o.value?[]:o.value.split(";")).map((function(e){var t,n;if(n=e,/^CC\d=/.test(e)){var r=e.split("=");t=r[0],n=r[1]}else/^CC\d$/.test(e)&&(t=e);return{channel:t,language:n}})):"urn:scte:dash:cc:cea-708:2015"===o.schemeIdUri?("string"!=typeof o.value?[]:o.value.split(";")).map((function(e){var t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var n=e.split("="),r=n[0],i=n[1],a=void 0===i?"":i;t.channel=r,t.language=e,a.split(",").forEach((function(e){var n=e.split(":"),r=n[0],i=n[1];"lang"===r?t.language=i:"er"===r?t.easyReader=Number(i):"war"===r?t.aspectRatio=Number(i):"3D"===r&&(t["3D"]=Number(i))}))}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})):void 0;f&&(d=r(d,{captionServices:f}));var p=V(i,"Label")[0];if(p&&p.childNodes.length){var v=p.childNodes[0].nodeValue.trim();d=r(d,{label:v})}var g=V(i,"ContentProtection").reduce((function(e,t){var n=Z(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());var r=J[n.schemeIdUri];if(r){e[r]={attributes:n};var i=V(t,"cenc:pssh")[0];if(i){var a=W(i);e[r].pssh=a&&K(a)}}return e}),{});Object.keys(g).length&&(d=r(d,{contentProtection:g}));var h=ee(i),b=V(i,"Representation"),y=r(n,h);return a(b.map(function(e,t,n){return function(i){var a=V(i,"BaseURL"),o=Q(t,a),u=r(e,Z(i)),s=ee(i);return o.map((function(e){return{segmentInfo:r(n,s),attributes:r(u,{baseUrl:e})}}))}}(d,s,y)))}},ne=function(e,t){return function(n,i){var o=Q(t,V(n.node,"BaseURL")),u=r(e,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(u.periodDuration=n.attributes.duration);var s=V(n.node,"AdaptationSet"),c=ee(n.node);return a(s.map(te(u,o,c)))}},re=function(e,t){void 0===t&&(t={});var n=t,r=n.manifestUri,i=void 0===r?"":r,o=n.NOW,u=void 0===o?Date.now():o,c=n.clientOffset,l=void 0===c?0:c,d=V(e,"Period");if(!d.length)throw new Error(s);var m=V(e,"Location"),f=Z(e),p=Q([i],V(e,"BaseURL"));f.type=f.type||"static",f.sourceDuration=f.mediaPresentationDuration||0,f.NOW=u,f.clientOffset=l,m.length&&(f.locations=m.map(W));var v=[];return d.forEach((function(e,t){var n=Z(e),r=v[t-1];n.start=function(e){var t=e.attributes,n=e.priorPeriodAttributes,r=e.mpdType;return"number"==typeof t.start?t.start:n&&"number"==typeof n.start&&"number"==typeof n.duration?n.start+n.duration:n||"static"!==r?null:0}({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:f.type}),v.push({node:e,attributes:n})})),{locations:f.locations,representationInfo:a(v.map(ne(f,p)))}},ie=function(e){if(""===e)throw new Error(c);var n,r,i=new t.DOMParser;try{r=(n=i.parseFromString(e,"application/xml"))&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(e){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(l);return r};e.VERSION="0.21.1",e.addSidxSegmentsToPlaylist=S,e.generateSidxKey=N,e.inheritAttributes=re,e.parse=function(e,t){void 0===t&&(t={});var n=re(ie(e),t),r=H(n.representationInfo);return z({dashPlaylists:r,locations:n.locations,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest})},e.parseUTCTiming=function(e){return function(e){var t=V(e,"UTCTiming")[0];if(!t)return null;var n=Z(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(f)}return n}(ie(e))},e.stringToMpdXml=ie,e.toM3u8=z,e.toPlaylists=H,Object.defineProperty(e,"__esModule",{value:!0})}));
