/*! @name mpd-parser @version 0.21.1 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("path"),require("@xmldom/xmldom")):"function"==typeof define&&define.amd?define(["exports","path","@xmldom/xmldom"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mpdParser={},e.path,e.window)}(this,(function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=r(t),a=function(e){return!!e&&"object"==typeof e},o=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.reduce((function(t,n){return"object"!=typeof n||Object.keys(n).forEach((function(r){Array.isArray(t[r])&&Array.isArray(n[r])?t[r]=t[r].concat(n[r]):a(t[r])&&a(n[r])?t[r]=e(t[r],n[r]):t[r]=n[r]})),t}),{})},u=function(e){return Object.keys(e).map((function(t){return e[t]}))},s=function(e){return e.reduce((function(e,t){return e.concat(t)}),[])},l=function(e){if(!e.length)return[];for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},c=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},d="INVALID_NUMBER_OF_PERIOD",m="DASH_EMPTY_MANIFEST",f="DASH_INVALID_XML",p="NO_BASE_URL",g="SEGMENT_TIME_UNSPECIFIED",v="UNSUPPORTED_UTC_TIMING_SCHEME";var h=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){var n,r,i,a,o;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=o.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var u=o.parseURL(e);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var s=r.exec(u.path);u.netLoc=s[1],u.path=s[2]}u.netLoc&&!u.path&&(u.path="/");var l={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var c=u.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;l.path=o.normalizePath(d)}else l.path=u.path,a.params||(l.params=u.params,a.query||(l.query=u.query));return null===l.path&&(l.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(l)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o})),b="http://example.com",y=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window.location&&window.location.href||"");var n="function"==typeof window.URL,r=/^\/\//.test(e),i=!window.location&&!/\/\//i.test(e);if(n?e=new window.URL(e,window.location||b):/\/\//i.test(e)||(e=h.buildAbsoluteURL(window.location&&window.location.href||"",e)),n){var a=new URL(t,e);return i?a.href.slice(b.length):r?a.href.slice(a.protocol.length):a.href}return h.buildAbsoluteURL(e,t)},w=function(e){var t=e.baseUrl,n=void 0===t?"":t,r=e.source,i=void 0===r?"":r,a=e.range,o=void 0===a?"":a,u=e.indexRange,s=void 0===u?"":u,l={uri:i,resolvedUri:y(n||"",i)};if(o||s){var c,d=(o||s).split("-"),m=window.BigInt?window.BigInt(d[0]):parseInt(d[0],10),f=window.BigInt?window.BigInt(d[1]):parseInt(d[1],10);m<Number.MAX_SAFE_INTEGER&&"bigint"==typeof m&&(m=Number(m)),f<Number.MAX_SAFE_INTEGER&&"bigint"==typeof f&&(f=Number(f)),"bigint"==typeof(c="bigint"==typeof f||"bigint"==typeof m?window.BigInt(f)-window.BigInt(m)+window.BigInt(1):f-m+1)&&c<Number.MAX_SAFE_INTEGER&&(c=Number(c)),l.byterange={length:c,offset:m}}return l},U=function(e){return e&&"number"!=typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e},S={static:function(e){var t=e.duration,n=e.timescale,r=void 0===n?1:n,i=e.sourceDuration,a=e.periodDuration,o=U(e.endNumber),u=t/r;return"number"==typeof o?{start:0,end:o}:"number"==typeof a?{start:0,end:a/u}:{start:0,end:i/u}},dynamic:function(e){var t=e.NOW,n=e.clientOffset,r=e.availabilityStartTime,i=e.timescale,a=void 0===i?1:i,o=e.duration,u=e.periodStart,s=void 0===u?0:u,l=e.minimumUpdatePeriod,c=void 0===l?0:l,d=e.timeShiftBufferDepth,m=void 0===d?1/0:d,f=U(e.endNumber),p=(t+n)/1e3,g=r+s,v=p+c-g,h=Math.ceil(v*a/o),b=Math.floor((p-g-m)*a/o),y=Math.floor((p-g)*a/o);return{start:Math.max(0,b),end:"number"==typeof f?f:Math.min(h,y)}}},I=function(e){var t=e.type,n=e.duration,r=e.timescale,i=void 0===r?1:r,a=e.periodDuration,o=e.sourceDuration,u=S[t](e),s=function(e,t){for(var n=[],r=e;r<t;r++)n.push(r);return n}(u.start,u.end).map(function(e){return function(t){var n=e.duration,r=e.timescale,i=void 0===r?1:r,a=e.periodStart,o=e.startNumber;return{number:(void 0===o?1:o)+t,duration:n/i,timeline:a,time:t*n}}}(e));if("static"===t){var l=s.length-1,c="number"==typeof a?a:o;s[l].duration=c-n/i*l}return s},E=function(e){var t=e.baseUrl,n=e.initialization,r=void 0===n?{}:n,i=e.sourceDuration,a=e.indexRange,o=void 0===a?"":a,u=e.periodStart,s=e.presentationTime,l=e.number,c=void 0===l?0:l,d=e.duration;if(!t)throw new Error(p);var m=w({baseUrl:t,source:r.sourceURL,range:r.range}),f=w({baseUrl:t,source:t,indexRange:o});if(f.map=m,d){var g=I(e);g.length&&(f.duration=g[0].duration,f.timeline=g[0].timeline)}else i&&(f.duration=i,f.timeline=u);return f.presentationTime=s||u,f.number=c,[f]},T=function(e,t,n){var r,i=e.sidx.map?e.sidx.map:null,a=e.sidx.duration,o=e.timeline||0,u=e.sidx.byterange,s=u.offset+u.length,l=t.timescale,c=t.references.filter((function(e){return 1!==e.referenceType})),d=[],m=e.endList?"static":"dynamic",f=e.sidx.timeline,p=f,g=e.mediaSequence||0;r="bigint"==typeof t.firstOffset?window.BigInt(s)+t.firstOffset:s+t.firstOffset;for(var v=0;v<c.length;v++){var h=t.references[v],b=h.referencedSize,y=h.subsegmentDuration,w=void 0;w="bigint"==typeof r?r+window.BigInt(b)-window.BigInt(1):r+b-1;var U=E({baseUrl:n,timescale:l,timeline:o,periodStart:f,presentationTime:p,number:g,duration:y,sourceDuration:a,indexRange:r+"-"+w,type:m})[0];i&&(U.map=i),d.push(U),r+="bigint"==typeof r?window.BigInt(b):b,p+=y/l,g++}return e.segments=d,e},R=["AUDIO","SUBTITLES"],x=function(e){return(t=e,n=function(e){return e.timeline},u(t.reduce((function(e,t){return t.forEach((function(t){e[n(t)]=t})),e}),{}))).sort((function(e,t){return e.timeline>t.timeline?1:-1}));var t,n},D=function(e){var t,n,r=[];return t=e,n=function(e,t,n,i){r=r.concat(e.playlists||[])},R.forEach((function(e){for(var r in t.mediaGroups[e])for(var i in t.mediaGroups[e][r]){var a=t.mediaGroups[e][r][i];n(a,e,r,i)}})),r},L=function(e){var t=e.playlist,n=e.mediaSequence;t.mediaSequence=n,t.segments.forEach((function(e,n){e.number=t.mediaSequence+n}))},N=function(e){var t=e.oldManifest,n=e.newManifest,r=t.playlists.concat(D(t)),i=n.playlists.concat(D(n));return n.timelineStarts=x([t.timelineStarts,n.timelineStarts]),function(e){var t=e.oldPlaylists,n=e.newPlaylists,r=e.timelineStarts;n.forEach((function(e){e.discontinuitySequence=c(r,(function(t){return t.timeline===e.timeline}));var n=function(e,t){for(var n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null}(t,e.attributes.NAME);if(n&&!e.sidx){var i=e.segments[0],a=c(n.segments,(function(e){return Math.abs(e.presentationTime-i.presentationTime)<.016666666666666666}));if(-1===a)return L({playlist:e,mediaSequence:n.mediaSequence+n.segments.length}),e.segments[0].discontinuity=!0,e.discontinuityStarts.unshift(0),void((!n.segments.length&&e.timeline>n.timeline||n.segments.length&&e.timeline>n.segments[n.segments.length-1].timeline)&&e.discontinuitySequence--);n.segments[a].discontinuity&&!i.discontinuity&&(i.discontinuity=!0,e.discontinuityStarts.unshift(0),e.discontinuitySequence--),L({playlist:e,mediaSequence:n.segments[a].number})}}))}({oldPlaylists:r,newPlaylists:i,timelineStarts:n.timelineStarts}),n},P=function(e){return e&&e.uri+"-"+(t=e.byterange,n="bigint"==typeof t.offset||"bigint"==typeof t.length?window.BigInt(t.offset)+window.BigInt(t.length)-window.BigInt(1):t.offset+t.length-1,t.offset+"-"+n);var t,n},M=function(e){return u(e.reduce((function(e,t){var n,r=t.attributes.id+(t.attributes.lang||"");e[r]?t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),(n=e[r].segments).push.apply(n,t.segments)):(e[r]=t,e[r].attributes.timelineStarts=[]);return e[r].attributes.timelineStarts.push({start:t.attributes.periodStart}),e}),{})).map((function(e){return e}))},A=function(e,t){var n=P(e.sidx),r=n&&t[n]&&t[n].sidx;return r&&T(e,r,e.sidx.resolvedUri),e},O=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var n in e)e[n]=A(e[n],t);return e},B=function(e){var t=e.attributes,n=e.segments,r=e.sidx,a={timelineStarts:t.timelineStarts,representationID:n[0].templateValues.RepresentationID,assetFileExt:i.default.extname(n[0].uri),initFileExt:i.default.extname(n[0].map.uri),initUri:n[0].map.uri,initResolvedUri:n[0].map.resolvedUri,segmentTemplateMedia:t.media,segmentTemplateInit:t.initialization.sourceURL,segments:n};return r&&(a.sidx=r),a},z=function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType},F=function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType},_=function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType},q=function(e){return e?Object.keys(e).reduce((function(t,n){var r=e[n];return t.concat(r.playlists)}),[]):[]},j=function(e){var t=e.dashPlaylists,n=e.locations,r=e.sidxMapping,a=void 0===r?{}:r,o=e.previousManifest;if(!t.length)return{};var u=t[0].attributes;u.sourceDuration;var s=u.type,l=u.suggestedPresentationDelay,c=u.minimumUpdatePeriod,d=M(t.filter(z)).map(B),m=M(t.filter(F)),f=M(t.filter(_));t.map((function(e){return e.attributes.captionServices})).filter(Boolean);var p={playlists:O(d,a)};c>=0&&(p.minimumUpdatePeriod=1e3*c),n&&(p.locations=n),"dynamic"===s&&(p.suggestedPresentationDelay=l);var g,v=0===p.playlists.length,h=m.length?function(e,t,n){var r;void 0===t&&(t={}),void 0===n&&(n=!1);var i=e.reduce((function(e,i){var a=i.attributes.role&&i.attributes.role.value||"",o=i.attributes.lang||"",u=i.attributes.label||"main";if(o&&!i.attributes.label){var s=a?" ("+a+")":"";u=""+i.attributes.lang+s}e[u]||(e[u]={language:o,autoselect:!0,default:"main"===a,playlists:[]});var l=A(function(e,t){var n=e.attributes,r=e.segments,i=e.sidx,a={timelineStarts:n.timelineStarts,segments:r};return i&&(a.sidx=i),t&&(a.attributes.AUDIO="audio",a.attributes.SUBTITLES="subs"),a}(i,n),t);return e[u].playlists.push(l),void 0===r&&"main"===a&&((r=i).default=!0),e}),{});return r||(i[Object.keys(i)[0]].default=!0),i}(m,a,v):null,b=f.length?function(e,t){return void 0===t&&(t={}),e.reduce((function(e,n){var r=n.attributes.lang||"text";return e[r]||(e[r]={language:r,default:!1,autoselect:!1,playlists:[]}),e[r].playlists.push(A(function(e){var t,n=e.attributes,r=e.segments;void 0===r&&(r=[{uri:n.baseUrl,resolvedUri:n.baseUrl||"",duration:n.sourceDuration,number:0}],n.duration=n.sourceDuration);var i=((t={NAME:n.id,BANDWIDTH:n.bandwidth})["PROGRAM-ID"]=1,t);return n.codecs&&(i.CODECS=n.codecs),{attributes:i,resolvedUri:n.baseUrl||"",segments:r}}(n),t)),e}),{})}(f,a):null,y=d.concat(q(h),q(b)),w=y.map((function(e){return e.timelineStarts}));if(p.timelineStarts=x(w),g=y,p.timelineStarts,g.forEach((function(e){e.segments&&e.segments.forEach((function(e,t){e.number=t}))})),h){var U=[];U.push.apply(U,Object.values(h)),U.forEach((function(e){p.playlists.push({representationID:e.playlists[0].segments[0].templateValues.RepresentationID,assetFileExt:i.default.extname(e.playlists[0].segments[0].uri),initFileExt:i.default.extname(e.playlists[0].segments[0].map.uri),initResolvedUri:e.playlists[0].segments[0].map.resolvedUri,initUri:e.playlists[0].segments[0].map.uri,segments:e.playlists[0].segments,segmentTemplateMedia:e.playlists[0].segments[0].attributes.media,segmentTemplateInit:e.playlists[0].segments[0].attributes.initialization.sourceURL})}))}return o?N({oldManifest:o,newManifest:p}):p},C=function(e,t,n){var r=e.NOW,i=e.clientOffset,a=e.availabilityStartTime,o=e.timescale,u=void 0===o?1:o,s=e.periodStart,l=void 0===s?0:s,c=e.minimumUpdatePeriod,d=(r+i)/1e3+(void 0===c?0:c)-(a+l);return Math.ceil((d*u-t)/n)},k=function(e,t){for(var n=e.type,r=e.minimumUpdatePeriod,i=void 0===r?0:r,a=e.media,o=void 0===a?"":a,u=e.sourceDuration,s=e.timescale,l=void 0===s?1:s,c=e.startNumber,d=void 0===c?1:c,m=e.periodStart,f=[],p=-1,g=0;g<t.length;g++){var v=t[g],h=v.d,b=v.r||0,y=v.t||0;p<0&&(p=y),y&&y>p&&(p=y);var w=void 0;if(b<0){var U=g+1;w=U===t.length?"dynamic"===n&&i>0&&o.indexOf("$Number$")>0?C(e,p,h):(u*l-p)/h:(t[U].t-p)/h}else w=b+1;for(var S=d+f.length+w,I=d+f.length;I<S;)f.push({number:I,duration:h/l,time:p,timeline:m}),p+=h,I++}return f},$=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,G=function(e,t){return e.replace($,function(e){return function(t,n,r,i){if("$$"===t)return"$";if(void 0===e[n])return t;var a=""+e[n];return"RepresentationID"===n?a:(i=r?parseInt(i,10):1,a.length>=i?a:""+new Array(i-a.length+1).join("0")+a)}}(t))},V=function(e,t){var n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},r=e.initialization,i=void 0===r?{sourceURL:"",range:""}:r,a=w({baseUrl:e.baseUrl,source:G(i.sourceURL,n),range:i.range}),o=function(e,t){return e.duration||t?e.duration?I(e):k(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}]}(e,t);return o.map((function(t){n.Number=t.number,n.Time=t.time;var r=G(e.media||"",n);e.timescale,e.presentationTimeOffset;return e.periodStart,t.time,{uri:r,resolvedUri:y(e.baseUrl||"",r),map:a,number:t.number,templateValues:n,segment:t,attributes:e}}))},H=function(e,t){var n=e.duration,r=e.segmentUrls,i=void 0===r?[]:r,a=e.periodStart;if(!n&&!t||n&&t)throw new Error(g);var o,u=i.map((function(t){return function(e,t){var n=e.baseUrl,r=e.initialization,i=void 0===r?{}:r,a=w({baseUrl:n,source:i.sourceURL,range:i.range}),o=w({baseUrl:n,source:t.media,range:t.mediaRange});return o.map=a,o}(e,t)}));return n&&(o=I(e)),t&&(o=k(e,t)),o.map((function(t,n){if(u[n]){var r=u[n],i=e.timescale||1,o=e.presentationTimeOffset||0;return r.timeline=t.timeline,r.duration=t.duration,r.number=t.number,r.presentationTime=a+(t.time-o)/i,r}})).filter((function(e){return e}))},W=function(e){var t,n,r=e.attributes,i=e.segmentInfo;i.template?(n=V,t=o(r,i.template)):i.base?(n=E,t=o(r,i.base)):i.list&&(n=H,t=o(r,i.list));var a={attributes:r};if(!n)return a;var u=n(t,i.segmentTimeline);if(t.duration){var s=t,l=s.duration,c=s.timescale,d=void 0===c?1:c;t.duration=l/d}else u.length?t.duration=u.reduce((function(e,t){return Math.max(e,Math.ceil(t.duration))}),0):t.duration=0;return a.attributes=t,a.segments=u,i.base&&t.indexRange&&(a.sidx=u[0],a.segments=[]),a},X=function(e){return e.map(W)},Y=function(e,t){return l(e.childNodes).filter((function(e){return e.tagName===t}))},Z=function(e){return e.textContent.trim()},K=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var n=t.slice(1),r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5];return 31536e3*parseFloat(r||0)+2592e3*parseFloat(i||0)+86400*parseFloat(a||0)+3600*parseFloat(o||0)+60*parseFloat(u||0)+parseFloat(s||0)},J={mediaPresentationDuration:function(e){return K(e)},availabilityStartTime:function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:function(e){return K(e)},suggestedPresentationDelay:function(e){return K(e)},type:function(e){return e},timeShiftBufferDepth:function(e){return K(e)},start:function(e){return K(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},presentationTimeOffset:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?K(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},Q=function(e){return e&&e.attributes?l(e.attributes).reduce((function(e,t){var n=J[t.name]||J.DEFAULT;return e[t.name]=n(t.value),e}),{}):{}};function ee(e){for(var t,n=(t=e,window.atob?window.atob(t):Buffer.from(t,"base64").toString("binary")),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}var te={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},ne=function(e,t){return t.length?s(e.map((function(e){return t.map((function(t){return y(e,Z(t))}))}))):e},re=function(e){var t=Y(e,"SegmentTemplate")[0],n=Y(e,"SegmentList")[0],r=n&&Y(n,"SegmentURL").map((function(e){return o({tag:"SegmentURL"},Q(e))})),i=Y(e,"SegmentBase")[0],a=n||t,u=a&&Y(a,"SegmentTimeline")[0],s=n||i||t,l=s&&Y(s,"Initialization")[0],c=t&&Q(t);c&&l?c.initialization=l&&Q(l):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});var d={template:c,segmentTimeline:u&&Y(u,"S").map((function(e){return Q(e)})),list:n&&o(Q(n),{segmentUrls:r,initialization:Q(l)}),base:i&&o(Q(i),{initialization:Q(l)})};return Object.keys(d).forEach((function(e){d[e]||delete d[e]})),d},ie=function(e,t,n){return function(r){var i,a=Q(r),u=ne(t,Y(r,"BaseURL")),l=Y(r,"Role")[0],c={role:Q(l)},d=o(e,a,c),m=Y(r,"Accessibility")[0],f="urn:scte:dash:cc:cea-608:2015"===(i=Q(m)).schemeIdUri?("string"!=typeof i.value?[]:i.value.split(";")).map((function(e){var t,n;if(n=e,/^CC\d=/.test(e)){var r=e.split("=");t=r[0],n=r[1]}else/^CC\d$/.test(e)&&(t=e);return{channel:t,language:n}})):"urn:scte:dash:cc:cea-708:2015"===i.schemeIdUri?("string"!=typeof i.value?[]:i.value.split(";")).map((function(e){var t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var n=e.split("="),r=n[0],i=n[1],a=void 0===i?"":i;t.channel=r,t.language=e,a.split(",").forEach((function(e){var n=e.split(":"),r=n[0],i=n[1];"lang"===r?t.language=i:"er"===r?t.easyReader=Number(i):"war"===r?t.aspectRatio=Number(i):"3D"===r&&(t["3D"]=Number(i))}))}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})):void 0;f&&(d=o(d,{captionServices:f}));var p=Y(r,"Label")[0];if(p&&p.childNodes.length){var g=p.childNodes[0].nodeValue.trim();d=o(d,{label:g})}var v=Y(r,"ContentProtection").reduce((function(e,t){var n=Q(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());var r=te[n.schemeIdUri];if(r){e[r]={attributes:n};var i=Y(t,"cenc:pssh")[0];if(i){var a=Z(i);e[r].pssh=a&&ee(a)}}return e}),{});Object.keys(v).length&&(d=o(d,{contentProtection:v}));var h=re(r),b=Y(r,"Representation"),y=o(n,h);return s(b.map(function(e,t,n){return function(r){var i=Y(r,"BaseURL"),a=ne(t,i),u=o(e,Q(r)),s=re(r);return a.map((function(e){return{segmentInfo:o(n,s),attributes:o(u,{baseUrl:e})}}))}}(d,u,y)))}},ae=function(e,t){return function(n,r){var i=ne(t,Y(n.node,"BaseURL")),a=o(e,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(a.periodDuration=n.attributes.duration);var u=Y(n.node,"AdaptationSet"),l=re(n.node);return s(u.map(ie(a,i,l)))}},oe=function(e,t){void 0===t&&(t={});var n=t,r=n.manifestUri,i=void 0===r?"":r,a=n.NOW,o=void 0===a?Date.now():a,u=n.clientOffset,l=void 0===u?0:u,c=Y(e,"Period");if(!c.length)throw new Error(d);var m=Y(e,"Location"),f=Q(e),p=ne([i],Y(e,"BaseURL"));f.type=f.type||"static",f.sourceDuration=f.mediaPresentationDuration||0,f.NOW=o,f.clientOffset=l,m.length&&(f.locations=m.map(Z));var g=[];return c.forEach((function(e,t){var n=Q(e),r=g[t-1];n.start=function(e){var t=e.attributes,n=e.priorPeriodAttributes,r=e.mpdType;return"number"==typeof t.start?t.start:n&&"number"==typeof n.start&&"number"==typeof n.duration?n.start+n.duration:n||"static"!==r?null:0}({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:f.type}),g.push({node:e,attributes:n})})),{locations:f.locations,representationInfo:s(g.map(ae(f,p)))}},ue=function(e){if(""===e)throw new Error(m);var t,r,i=new n.DOMParser;try{r=(t=i.parseFromString(e,"application/xml"))&&"MPD"===t.documentElement.tagName?t.documentElement:null}catch(e){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(f);return r};e.VERSION="0.21.1",e.addSidxSegmentsToPlaylist=T,e.generateSidxKey=P,e.inheritAttributes=oe,e.parse=function(e,t){void 0===t&&(t={});var n=oe(ue(e),t),r=X(n.representationInfo);return j({dashPlaylists:r,locations:n.locations,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest})},e.parseUTCTiming=function(e){return function(e){var t=Y(e,"UTCTiming")[0];if(!t)return null;var n=Q(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(v)}return n}(ue(e))},e.stringToMpdXml=ue,e.toM3u8=j,e.toPlaylists=X,Object.defineProperty(e,"__esModule",{value:!0})}));
