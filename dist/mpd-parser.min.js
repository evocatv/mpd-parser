/*! @name mpd-parser @version 0.21.1 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@xmldom/xmldom")):"function"==typeof define&&define.amd?define(["exports","@xmldom/xmldom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).mpdParser={},t.window)}(this,(function(t,e){"use strict";var n=function(t){return!!t&&"object"==typeof t},r=function t(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return r.reduce((function(e,r){return"object"!=typeof r||Object.keys(r).forEach((function(i){Array.isArray(e[i])&&Array.isArray(r[i])?e[i]=e[i].concat(r[i]):n(e[i])&&n(r[i])?e[i]=t(e[i],r[i]):e[i]=r[i]})),e}),{})},i=function(t){return Object.keys(t).map((function(e){return t[e]}))},a=function(t){return t.reduce((function(t,e){return t.concat(e)}),[])},o=function(t){if(!t.length)return[];for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},u=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1},s="INVALID_NUMBER_OF_PERIOD",c="DASH_EMPTY_MANIFEST",l="DASH_INVALID_XML",d="NO_BASE_URL",m="SEGMENT_TIME_UNSPECIFIED",f="UNSUPPORTED_UTC_TIMING_SCHEME";var p=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}((function(t,e){var n,r,i,a,o;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=o.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var a=o.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):e;var u=o.parseURL(t);if(!u)throw new Error("Error trying to parse base URL.");if(!u.netLoc&&u.path&&"/"!==u.path[0]){var s=r.exec(u.path);u.netLoc=s[1],u.path=s[2]}u.netLoc&&!u.path&&(u.path="/");var c={scheme:u.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=u.netLoc,"/"!==a.path[0]))if(a.path){var l=u.path,d=l.substring(0,l.lastIndexOf("/")+1)+a.path;c.path=o.normalizePath(d)}else c.path=u.path,a.params||(c.params=u.params,a.query||(c.query=u.query));return null===c.path&&(c.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(c)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(i,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=o})),v="http://example.com",g=function(t,e){if(/^[a-z]+:/i.test(e))return e;/^data:/.test(t)&&(t=window.location&&window.location.href||"");var n="function"==typeof window.URL,r=/^\/\//.test(t),i=!window.location&&!/\/\//i.test(t);if(n?t=new window.URL(t,window.location||v):/\/\//i.test(t)||(t=p.buildAbsoluteURL(window.location&&window.location.href||"",t)),n){var a=new URL(e,t);return i?a.href.slice(v.length):r?a.href.slice(a.protocol.length):a.href}return p.buildAbsoluteURL(t,e)},h=function(t){var e=t.baseUrl,n=void 0===e?"":e,r=t.source,i=void 0===r?"":r,a=t.range,o=void 0===a?"":a,u=t.indexRange,s=void 0===u?"":u,c={uri:i,resolvedUri:g(n||"",i)};if(o||s){var l,d=(o||s).split("-"),m=window.BigInt?window.BigInt(d[0]):parseInt(d[0],10),f=window.BigInt?window.BigInt(d[1]):parseInt(d[1],10);m<Number.MAX_SAFE_INTEGER&&"bigint"==typeof m&&(m=Number(m)),f<Number.MAX_SAFE_INTEGER&&"bigint"==typeof f&&(f=Number(f)),"bigint"==typeof(l="bigint"==typeof f||"bigint"==typeof m?window.BigInt(f)-window.BigInt(m)+window.BigInt(1):f-m+1)&&l<Number.MAX_SAFE_INTEGER&&(l=Number(l)),c.byterange={length:l,offset:m}}return c},b=function(t){return t&&"number"!=typeof t&&(t=parseInt(t,10)),isNaN(t)?null:t},y={static:function(t){var e=t.duration,n=t.timescale,r=void 0===n?1:n,i=t.sourceDuration,a=t.periodDuration,o=b(t.endNumber),u=e/r;return"number"==typeof o?{start:0,end:o}:"number"==typeof a?{start:0,end:a/u}:{start:0,end:i/u}},dynamic:function(t){var e=t.NOW,n=t.clientOffset,r=t.availabilityStartTime,i=t.timescale,a=void 0===i?1:i,o=t.duration,u=t.periodStart,s=void 0===u?0:u,c=t.minimumUpdatePeriod,l=void 0===c?0:c,d=t.timeShiftBufferDepth,m=void 0===d?1/0:d,f=b(t.endNumber),p=(e+n)/1e3,v=r+s,g=p+l-v,h=Math.ceil(g*a/o),y=Math.floor((p-v-m)*a/o),w=Math.floor((p-v)*a/o);return{start:Math.max(0,y),end:"number"==typeof f?f:Math.min(h,w)}}},w=function(t){var e=t.type,n=t.duration,r=t.timescale,i=void 0===r?1:r,a=t.periodDuration,o=t.sourceDuration,u=y[e](t),s=function(t,e){for(var n=[],r=t;r<e;r++)n.push(r);return n}(u.start,u.end).map(function(t){return function(e){var n=t.duration,r=t.timescale,i=void 0===r?1:r,a=t.periodStart,o=t.startNumber;return{number:(void 0===o?1:o)+e,duration:n/i,timeline:a,time:e*n}}}(t));if("static"===e){var c=s.length-1,l="number"==typeof a?a:o;s[c].duration=l-n/i*c}return s},U=function(t){var e=t.baseUrl,n=t.initialization,r=void 0===n?{}:n,i=t.sourceDuration,a=t.indexRange,o=void 0===a?"":a,u=t.periodStart,s=t.presentationTime,c=t.number,l=void 0===c?0:c,m=t.duration;if(!e)throw new Error(d);var f=h({baseUrl:e,source:r.sourceURL,range:r.range}),p=h({baseUrl:e,source:e,indexRange:o});if(p.map=f,m){var v=w(t);v.length&&(p.duration=v[0].duration,p.timeline=v[0].timeline)}else i&&(p.duration=i,p.timeline=u);return p.presentationTime=s||u,p.number=l,[p]},S=function(t,e,n){var r,i=t.sidx.map?t.sidx.map:null,a=t.sidx.duration,o=t.timeline||0,u=t.sidx.byterange,s=u.offset+u.length,c=e.timescale,l=e.references.filter((function(t){return 1!==t.referenceType})),d=[],m=t.endList?"static":"dynamic",f=t.sidx.timeline,p=f,v=t.mediaSequence||0;r="bigint"==typeof e.firstOffset?window.BigInt(s)+e.firstOffset:s+e.firstOffset;for(var g=0;g<l.length;g++){var h=e.references[g],b=h.referencedSize,y=h.subsegmentDuration,w=void 0;w="bigint"==typeof r?r+window.BigInt(b)-window.BigInt(1):r+b-1;var S=U({baseUrl:n,timescale:c,timeline:o,periodStart:f,presentationTime:p,number:v,duration:y,sourceDuration:a,indexRange:r+"-"+w,type:m})[0];i&&(S.map=i),d.push(S),r+="bigint"==typeof r?window.BigInt(b):b,p+=y/c,v++}return t.segments=d,t},I=["AUDIO","SUBTITLES"],E=function(t){return(e=t,n=function(t){return t.timeline},i(e.reduce((function(t,e){return e.forEach((function(e){t[n(e)]=e})),t}),{}))).sort((function(t,e){return t.timeline>e.timeline?1:-1}));var e,n},T=function(t){var e,n,r=[];return e=t,n=function(t,e,n,i){r=r.concat(t.playlists||[])},I.forEach((function(t){for(var r in e.mediaGroups[t])for(var i in e.mediaGroups[t][r]){var a=e.mediaGroups[t][r][i];n(a,t,r,i)}})),r},R=function(t){var e=t.playlist,n=t.mediaSequence;e.mediaSequence=n,e.segments.forEach((function(t,n){t.number=e.mediaSequence+n}))},L=function(t){var e=t.oldManifest,n=t.newManifest,r=e.playlists.concat(T(e)),i=n.playlists.concat(T(n));return n.timelineStarts=E([e.timelineStarts,n.timelineStarts]),function(t){var e=t.oldPlaylists,n=t.newPlaylists,r=t.timelineStarts;n.forEach((function(t){t.discontinuitySequence=u(r,(function(e){return e.timeline===t.timeline}));var n=function(t,e){for(var n=0;n<t.length;n++)if(t[n].attributes.NAME===e)return t[n];return null}(e,t.attributes.NAME);if(n&&!t.sidx){var i=t.segments[0],a=u(n.segments,(function(t){return Math.abs(t.presentationTime-i.presentationTime)<.016666666666666666}));if(-1===a)return R({playlist:t,mediaSequence:n.mediaSequence+n.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!n.segments.length&&t.timeline>n.timeline||n.segments.length&&t.timeline>n.segments[n.segments.length-1].timeline)&&t.discontinuitySequence--);n.segments[a].discontinuity&&!i.discontinuity&&(i.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),R({playlist:t,mediaSequence:n.segments[a].number})}}))}({oldPlaylists:r,newPlaylists:i,timelineStarts:n.timelineStarts}),n},N=function(t){return t&&t.uri+"-"+(e=t.byterange,n="bigint"==typeof e.offset||"bigint"==typeof e.length?window.BigInt(e.offset)+window.BigInt(e.length)-window.BigInt(1):e.offset+e.length-1,e.offset+"-"+n);var e,n},x=function(t){return i(t.reduce((function(t,e){var n,r=e.attributes.id+(e.attributes.lang||"");t[r]?e.segments&&(e.segments[0]&&(e.segments[0].discontinuity=!0),(n=t[r].segments).push.apply(n,e.segments)):(t[r]=e,t[r].attributes.timelineStarts=[]);return t[r].attributes.timelineStarts.push({start:e.attributes.periodStart}),t}),{})).map((function(t){return t}))},D=function(t,e){var n=N(t.sidx),r=n&&e[n]&&e[n].sidx;return r&&S(t,r,t.sidx.resolvedUri),t},P=function(t,e){if(void 0===e&&(e={}),!Object.keys(e).length)return t;for(var n in t)t[n]=D(t[n],e);return t},M=function(t){var e=t.attributes,n=t.segments,r=t.sidx,i={timelineStarts:e.timelineStarts,initUri:n[0].map.uri,initResolvedUri:n[0].map.resolvedUri,segments:n};return r&&(i.sidx=r),i},A=function(t){var e=t.attributes;return"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType},O=function(t){var e=t.attributes;return"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType},B=function(t){var e=t.attributes;return"text/vtt"===e.mimeType||"text"===e.contentType},z=function(t){return t?Object.keys(t).reduce((function(e,n){var r=t[n];return e.concat(r.playlists)}),[]):[]},_=function(t){var e=t.dashPlaylists,n=t.locations,r=t.sidxMapping,i=void 0===r?{}:r,a=t.previousManifest;if(!e.length)return{};var o=e[0].attributes;o.sourceDuration;var u=o.type,s=o.suggestedPresentationDelay,c=o.minimumUpdatePeriod,l=x(e.filter(A)).map(M),d=x(e.filter(O)),m=x(e.filter(B));e.map((function(t){return t.attributes.captionServices})).filter(Boolean);var f={playlists:P(l,i)};c>=0&&(f.minimumUpdatePeriod=1e3*c),n&&(f.locations=n),"dynamic"===u&&(f.suggestedPresentationDelay=s);var p,v=0===f.playlists.length,g=d.length?function(t,e,n){var r;void 0===e&&(e={}),void 0===n&&(n=!1);var i=t.reduce((function(t,i){var a=i.attributes.role&&i.attributes.role.value||"",o=i.attributes.lang||"",u=i.attributes.label||"main";if(o&&!i.attributes.label){var s=a?" ("+a+")":"";u=""+i.attributes.lang+s}t[u]||(t[u]={language:o,autoselect:!0,default:"main"===a,playlists:[]});var c=D(function(t,e){var n=t.attributes,r=t.segments,i=t.sidx,a={timelineStarts:n.timelineStarts,segments:r};return i&&(a.sidx=i),e&&(a.attributes.AUDIO="audio",a.attributes.SUBTITLES="subs"),a}(i,n),e);return t[u].playlists.push(c),void 0===r&&"main"===a&&((r=i).default=!0),t}),{});return r||(i[Object.keys(i)[0]].default=!0),i}(d,i,v):null,h=m.length?function(t,e){return void 0===e&&(e={}),t.reduce((function(t,n){var r=n.attributes.lang||"text";return t[r]||(t[r]={language:r,default:!1,autoselect:!1,playlists:[]}),t[r].playlists.push(D(function(t){var e,n=t.attributes,r=t.segments;void 0===r&&(r=[{uri:n.baseUrl,resolvedUri:n.baseUrl||"",duration:n.sourceDuration,number:0}],n.duration=n.sourceDuration);var i=((e={NAME:n.id,BANDWIDTH:n.bandwidth})["PROGRAM-ID"]=1,e);return n.codecs&&(i.CODECS=n.codecs),{attributes:i,resolvedUri:n.baseUrl||"",segments:r}}(n),e)),t}),{})}(m,i):null,b=l.concat(z(g),z(h)),y=b.map((function(t){return t.timelineStarts}));if(f.timelineStarts=E(y),p=b,f.timelineStarts,p.forEach((function(t){t.segments&&t.segments.forEach((function(t,e){t.number=e}))})),g){var w=[];w.push.apply(w,Object.values(g)),w.forEach((function(t){f.playlists.push({initResolvedUri:t.playlists[0].segments[0].map.resolvedUri,initUri:t.playlists[0].segments[0].map.uri,segments:t.playlists})}))}return a?L({oldManifest:a,newManifest:f}):f},q=function(t,e,n){var r=t.NOW,i=t.clientOffset,a=t.availabilityStartTime,o=t.timescale,u=void 0===o?1:o,s=t.periodStart,c=void 0===s?0:s,l=t.minimumUpdatePeriod,d=(r+i)/1e3+(void 0===l?0:l)-(a+c);return Math.ceil((d*u-e)/n)},F=function(t,e){for(var n=t.type,r=t.minimumUpdatePeriod,i=void 0===r?0:r,a=t.media,o=void 0===a?"":a,u=t.sourceDuration,s=t.timescale,c=void 0===s?1:s,l=t.startNumber,d=void 0===l?1:l,m=t.periodStart,f=[],p=-1,v=0;v<e.length;v++){var g=e[v],h=g.d,b=g.r||0,y=g.t||0;p<0&&(p=y),y&&y>p&&(p=y);var w=void 0;if(b<0){var U=v+1;w=U===e.length?"dynamic"===n&&i>0&&o.indexOf("$Number$")>0?q(t,p,h):(u*c-p)/h:(e[U].t-p)/h}else w=b+1;for(var S=d+f.length+w,I=d+f.length;I<S;)f.push({number:I,duration:h/c,time:p,timeline:m}),p+=h,I++}return f},C=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,j=function(t,e){return t.replace(C,function(t){return function(e,n,r,i){if("$$"===e)return"$";if(void 0===t[n])return e;var a=""+t[n];return"RepresentationID"===n?a:(i=r?parseInt(i,10):1,a.length>=i?a:""+new Array(i-a.length+1).join("0")+a)}}(e))},k=function(t,e){var n={RepresentationID:t.id,Bandwidth:t.bandwidth||0},r=t.initialization,i=void 0===r?{sourceURL:"",range:""}:r,a=h({baseUrl:t.baseUrl,source:j(i.sourceURL,n),range:i.range}),o=function(t,e){return t.duration||e?t.duration?w(t):F(t,e):[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodStart}]}(t,e);return o.map((function(e){n.Number=e.number,n.Time=e.time;var r=j(t.media||"",n),i=t.timescale||1,o=t.presentationTimeOffset||0,u=t.periodStart+(e.time-o)/i;return{uri:r,resolvedUri:g(t.baseUrl||"",r),map:a,number:e.number,presentationTime:u,templateValues:n,segment:e,attributes:t}}))},$=function(t,e){var n=t.duration,r=t.segmentUrls,i=void 0===r?[]:r,a=t.periodStart;if(!n&&!e||n&&e)throw new Error(m);var o,u=i.map((function(e){return function(t,e){var n=t.baseUrl,r=t.initialization,i=void 0===r?{}:r,a=h({baseUrl:n,source:i.sourceURL,range:i.range}),o=h({baseUrl:n,source:e.media,range:e.mediaRange});return o.map=a,o}(t,e)}));return n&&(o=w(t)),e&&(o=F(t,e)),o.map((function(e,n){if(u[n]){var r=u[n],i=t.timescale||1,o=t.presentationTimeOffset||0;return r.timeline=e.timeline,r.duration=e.duration,r.number=e.number,r.presentationTime=a+(e.time-o)/i,r}})).filter((function(t){return t}))},G=function(t){var e,n,i=t.attributes,a=t.segmentInfo;a.template?(n=k,e=r(i,a.template)):a.base?(n=U,e=r(i,a.base)):a.list&&(n=$,e=r(i,a.list));var o={attributes:i};if(!n)return o;var u=n(e,a.segmentTimeline);if(e.duration){var s=e,c=s.duration,l=s.timescale,d=void 0===l?1:l;e.duration=c/d}else u.length?e.duration=u.reduce((function(t,e){return Math.max(t,Math.ceil(e.duration))}),0):e.duration=0;return o.attributes=e,o.segments=u,a.base&&e.indexRange&&(o.sidx=u[0],o.segments=[]),o},H=function(t){return t.map(G)},V=function(t,e){return o(t.childNodes).filter((function(t){return t.tagName===e}))},W=function(t){return t.textContent.trim()},X=function(t){var e=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(t);if(!e)return 0;var n=e.slice(1),r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5];return 31536e3*parseFloat(r||0)+2592e3*parseFloat(i||0)+86400*parseFloat(a||0)+3600*parseFloat(o||0)+60*parseFloat(u||0)+parseFloat(s||0)},Y={mediaPresentationDuration:function(t){return X(t)},availabilityStartTime:function(t){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e=t)&&(e+="Z"),Date.parse(e)/1e3;var e},minimumUpdatePeriod:function(t){return X(t)},suggestedPresentationDelay:function(t){return X(t)},type:function(t){return t},timeShiftBufferDepth:function(t){return X(t)},start:function(t){return X(t)},width:function(t){return parseInt(t,10)},height:function(t){return parseInt(t,10)},bandwidth:function(t){return parseInt(t,10)},startNumber:function(t){return parseInt(t,10)},timescale:function(t){return parseInt(t,10)},presentationTimeOffset:function(t){return parseInt(t,10)},duration:function(t){var e=parseInt(t,10);return isNaN(e)?X(t):e},d:function(t){return parseInt(t,10)},t:function(t){return parseInt(t,10)},r:function(t){return parseInt(t,10)},DEFAULT:function(t){return t}},Z=function(t){return t&&t.attributes?o(t.attributes).reduce((function(t,e){var n=Y[e.name]||Y.DEFAULT;return t[e.name]=n(e.value),t}),{}):{}};function K(t){for(var e,n=(e=t,window.atob?window.atob(e):Buffer.from(e,"base64").toString("binary")),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}var J={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Q=function(t,e){return e.length?a(t.map((function(t){return e.map((function(e){return g(t,W(e))}))}))):t},tt=function(t){var e=V(t,"SegmentTemplate")[0],n=V(t,"SegmentList")[0],i=n&&V(n,"SegmentURL").map((function(t){return r({tag:"SegmentURL"},Z(t))})),a=V(t,"SegmentBase")[0],o=n||e,u=o&&V(o,"SegmentTimeline")[0],s=n||a||e,c=s&&V(s,"Initialization")[0],l=e&&Z(e);l&&c?l.initialization=c&&Z(c):l&&l.initialization&&(l.initialization={sourceURL:l.initialization});var d={template:l,segmentTimeline:u&&V(u,"S").map((function(t){return Z(t)})),list:n&&r(Z(n),{segmentUrls:i,initialization:Z(c)}),base:a&&r(Z(a),{initialization:Z(c)})};return Object.keys(d).forEach((function(t){d[t]||delete d[t]})),d},et=function(t,e,n){return function(i){var o,u=Z(i),s=Q(e,V(i,"BaseURL")),c=V(i,"Role")[0],l={role:Z(c)},d=r(t,u,l),m=V(i,"Accessibility")[0],f="urn:scte:dash:cc:cea-608:2015"===(o=Z(m)).schemeIdUri?("string"!=typeof o.value?[]:o.value.split(";")).map((function(t){var e,n;if(n=t,/^CC\d=/.test(t)){var r=t.split("=");e=r[0],n=r[1]}else/^CC\d$/.test(t)&&(e=t);return{channel:e,language:n}})):"urn:scte:dash:cc:cea-708:2015"===o.schemeIdUri?("string"!=typeof o.value?[]:o.value.split(";")).map((function(t){var e={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){var n=t.split("="),r=n[0],i=n[1],a=void 0===i?"":i;e.channel=r,e.language=t,a.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];"lang"===r?e.language=i:"er"===r?e.easyReader=Number(i):"war"===r?e.aspectRatio=Number(i):"3D"===r&&(e["3D"]=Number(i))}))}else e.language=t;return e.channel&&(e.channel="SERVICE"+e.channel),e})):void 0;f&&(d=r(d,{captionServices:f}));var p=V(i,"Label")[0];if(p&&p.childNodes.length){var v=p.childNodes[0].nodeValue.trim();d=r(d,{label:v})}var g=V(i,"ContentProtection").reduce((function(t,e){var n=Z(e);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());var r=J[n.schemeIdUri];if(r){t[r]={attributes:n};var i=V(e,"cenc:pssh")[0];if(i){var a=W(i);t[r].pssh=a&&K(a)}}return t}),{});Object.keys(g).length&&(d=r(d,{contentProtection:g}));var h=tt(i),b=V(i,"Representation"),y=r(n,h);return a(b.map(function(t,e,n){return function(i){var a=V(i,"BaseURL"),o=Q(e,a),u=r(t,Z(i)),s=tt(i);return o.map((function(t){return{segmentInfo:r(n,s),attributes:r(u,{baseUrl:t})}}))}}(d,s,y)))}},nt=function(t,e){return function(n,i){var o=Q(e,V(n.node,"BaseURL")),u=r(t,{periodStart:n.attributes.start});"number"==typeof n.attributes.duration&&(u.periodDuration=n.attributes.duration);var s=V(n.node,"AdaptationSet"),c=tt(n.node);return a(s.map(et(u,o,c)))}},rt=function(t,e){void 0===e&&(e={});var n=e,r=n.manifestUri,i=void 0===r?"":r,o=n.NOW,u=void 0===o?Date.now():o,c=n.clientOffset,l=void 0===c?0:c,d=V(t,"Period");if(!d.length)throw new Error(s);var m=V(t,"Location"),f=Z(t),p=Q([i],V(t,"BaseURL"));f.type=f.type||"static",f.sourceDuration=f.mediaPresentationDuration||0,f.NOW=u,f.clientOffset=l,m.length&&(f.locations=m.map(W));var v=[];return d.forEach((function(t,e){var n=Z(t),r=v[e-1];n.start=function(t){var e=t.attributes,n=t.priorPeriodAttributes,r=t.mpdType;return"number"==typeof e.start?e.start:n&&"number"==typeof n.start&&"number"==typeof n.duration?n.start+n.duration:n||"static"!==r?null:0}({attributes:n,priorPeriodAttributes:r?r.attributes:null,mpdType:f.type}),v.push({node:t,attributes:n})})),{locations:f.locations,representationInfo:a(v.map(nt(f,p)))}},it=function(t){if(""===t)throw new Error(c);var n,r,i=new e.DOMParser;try{r=(n=i.parseFromString(t,"application/xml"))&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(t){}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(l);return r};t.VERSION="0.21.1",t.addSidxSegmentsToPlaylist=S,t.generateSidxKey=N,t.inheritAttributes=rt,t.parse=function(t,e){void 0===e&&(e={});var n=rt(it(t),e),r=H(n.representationInfo);return _({dashPlaylists:r,locations:n.locations,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest})},t.parseUTCTiming=function(t){return function(t){var e=V(t,"UTCTiming")[0];if(!e)return null;var n=Z(e);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;default:throw new Error(f)}return n}(it(t))},t.stringToMpdXml=it,t.toM3u8=_,t.toPlaylists=H,Object.defineProperty(t,"__esModule",{value:!0})}));
